#!/bin/bash
# ğŸš€ Flutter Web í´ë¦° ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ (HTML ë Œë”ëŸ¬ ì „ìš©)
# HTTP í™˜ê²½ì—ì„œ CanvasKit ì¶©ëŒ ë°©ì§€

set -e  # ì—ëŸ¬ ë°œìƒ ì‹œ ì¦‰ì‹œ ì¤‘ë‹¨

echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "ğŸ§¹ Flutter Web í´ë¦° ë¹Œë“œ & ë°°í¬ ì‹œì‘"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

# 1ï¸âƒ£ Flutter í”„ë¡œì íŠ¸ë¡œ ì´ë™
cd /home/dbs0510/heritage_services_app_dbs0510/my_cross_app

# 2ï¸âƒ£ ê¸°ì¡´ ë¹Œë“œ ìºì‹œ ì™„ì „ ì‚­ì œ
echo ""
echo "ğŸ“¦ [1/5] ê¸°ì¡´ ë¹Œë“œ ìºì‹œ ì‚­ì œ ì¤‘..."
flutter clean
rm -rf build
rm -rf .dart_tool
echo "âœ… ìºì‹œ ì‚­ì œ ì™„ë£Œ"

# 3ï¸âƒ£ HTML ë Œë”ëŸ¬ë¡œ ìƒˆë¡œ ë¹Œë“œ (CanvasKit ì œì™¸)
echo ""
echo "ğŸ”¨ [2/5] HTML ë Œë”ëŸ¬ë¡œ ë¹Œë“œ ì¤‘..."
flutter build web --pwa-strategy=none
echo "âœ… ë¹Œë“œ ì™„ë£Œ"

# 4ï¸âƒ£ Service Worker ë° CanvasKit íŒŒì¼ ì œê±° + HTML ë Œë”ëŸ¬ ê°•ì œ ì„¤ì •
echo ""
echo "ğŸ—‘ï¸  [3/5] ë¶ˆí•„ìš”í•œ íŒŒì¼ ì œê±° ë° ë Œë”ëŸ¬ ìˆ˜ì • ì¤‘..."
cd build/web
rm -f flutter_service_worker.js
rm -rf canvaskit

# ğŸ”¥ í•µì‹¬: flutter_bootstrap.jsì—ì„œ "canvaskit" â†’ "html"ë¡œ ê°•ì œ ë³€ê²½
sed -i 's/"renderer":"canvaskit"/"renderer":"html"/g' flutter_bootstrap.js

# ê²€ì¦
if grep -q '"renderer":"html"' flutter_bootstrap.js; then
  echo "âœ… HTML ë Œë”ëŸ¬ë¡œ ë³€ê²½ ì™„ë£Œ"
else
  echo "âš ï¸  ë Œë”ëŸ¬ ë³€ê²½ ì‹¤íŒ¨ - ìˆ˜ë™ í™•ì¸ í•„ìš”"
fi

echo "âœ… Service Worker & CanvasKit ì œê±° ì™„ë£Œ"

# 5ï¸âƒ£ Docker ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘ (Nginx ìºì‹œ ìë™ í´ë¦¬ì–´)
echo ""
echo "ğŸ”„ [4/5] Docker ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘ ì¤‘..."
cd /home/dbs0510/heritage_services_app_dbs0510
docker-compose restart heritage-web
echo "âœ… ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘ ì™„ë£Œ"

# 6ï¸âƒ£ ë°°í¬ ì™„ë£Œ ì•ˆë‚´
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "âœ… [5/5] ë°°í¬ ì™„ë£Œ!"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ğŸŒ ì„œë²„ ì£¼ì†Œ: http://210.117.181.115:3001"
echo ""
echo "âš ï¸  ì¤‘ìš”: ë¸Œë¼ìš°ì € ìºì‹œë¥¼ ë°˜ë“œì‹œ ì‚­ì œí•˜ì„¸ìš”!"
echo ""
echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "â”‚  ğŸ”§ ë¸Œë¼ìš°ì € Service Worker ì‚­ì œ ë°©ë²•:                      â”‚"
echo "â”‚                                                             â”‚"
echo "â”‚  1ï¸âƒ£  Chrome ì£¼ì†Œì°½ì— ì…ë ¥:                                  â”‚"
echo "â”‚      chrome://serviceworker-internals                      â”‚"
echo "â”‚                                                             â”‚"
echo "â”‚  2ï¸âƒ£  'heritage' ê²€ìƒ‰ â†’ Unregister í´ë¦­                      â”‚"
echo "â”‚                                                             â”‚"
echo "â”‚  3ï¸âƒ£  F12 â†’ Application íƒ­ â†’ Storage â†’                       â”‚"
echo "â”‚      'Clear site data' í´ë¦­                                â”‚"
echo "â”‚                                                             â”‚"
echo "â”‚  4ï¸âƒ£  Ctrl + Shift + R (ê°•ë ¥ ìƒˆë¡œê³ ì¹¨)                       â”‚"
echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
