# ğŸ”§ ì´ë¯¸ì§€ ë¡œë”© ë¬¸ì œ í•´ê²° ê°€ì´ë“œ

## ë¬¸ì œ ìƒí™©
- ë¬¸í™”ìœ ì‚° í˜„í™© ì‚¬ì§„ì´ ê¹¨ì§„ ì´ë¯¸ì§€ ì•„ì´ì½˜ìœ¼ë¡œ í‘œì‹œë¨
- ì‹¤ì œ ì‚¬ì§„ì€ Firebase Storageì— ì €ì¥ë˜ì–´ ìˆìŒ
- í¬ë¡¬ ë¸Œë¼ìš°ì €ì—ì„œ ì´ë¯¸ì§€ê°€ ë¡œë“œë˜ì§€ ì•ŠìŒ

## ì›ì¸ ë¶„ì„
1. **Firebase Storage CORS ì •ì±…**: ë¸Œë¼ìš°ì €ì—ì„œ Firebase Storageì— ì§ì ‘ ì ‘ê·¼í•  ë•Œ CORS ì˜¤ë¥˜ ë°œìƒ
2. **ì´ë¯¸ì§€ URL ìœ íš¨ì„±**: Firebase Storage URLì´ ì˜¬ë°”ë¥´ê²Œ ìƒì„±ë˜ì§€ ì•Šì•˜ì„ ê°€ëŠ¥ì„±
3. **ë„¤íŠ¸ì›Œí¬ ê¶Œí•œ**: Firebase Storage ì ‘ê·¼ ê¶Œí•œ ì„¤ì • ë¬¸ì œ

## í•´ê²° ë°©ë²•

### 1. Firebase Storage CORS ì„¤ì • (ê¶Œì¥)

#### ë°©ë²• A: gsutil ì‚¬ìš©
```bash
# 1. Google Cloud SDK ì„¤ì¹˜ (gsutil í¬í•¨)
# https://cloud.google.com/sdk/docs/install

# 2. Firebase í”„ë¡œì íŠ¸ì— ì¸ì¦
gcloud auth login

# 3. CORS ì„¤ì • ì ìš©
gsutil cors set firebase_storage_cors.json gs://heritageservices-23a6c.appspot.com
```

#### ë°©ë²• B: Firebase CLI ì‚¬ìš©
```bash
# 1. Firebase CLI ì„¤ì¹˜
npm install -g firebase-tools

# 2. ë¡œê·¸ì¸
firebase login

# 3. í”„ë¡œì íŠ¸ ì„¤ì •
firebase use heritageservices-23a6c

# 4. CORS ì„¤ì • ì ìš© (ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰)
./setup_firebase_cors.sh
```

### 2. Firebase Storage ë³´ì•ˆ ê·œì¹™ í™•ì¸

Firebase Console â†’ Storage â†’ Rulesì—ì„œ ë‹¤ìŒ ê·œì¹™ì´ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸:

```javascript
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /{allPaths=**} {
      allow read: if true;  // ì„ì‹œë¡œ ëª¨ë“  ì½ê¸° í—ˆìš©
      allow write: if request.auth != null;  // ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ì“°ê¸° í—ˆìš©
    }
  }
}
```

### 3. ì´ë¯¸ì§€ URL ë””ë²„ê¹…

ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ì—ì„œ ë‹¤ìŒì„ í™•ì¸:

1. **Network íƒ­**: ì´ë¯¸ì§€ ìš”ì²­ì´ ì‹¤íŒ¨í•˜ëŠ”ì§€ í™•ì¸
2. **Console íƒ­**: CORS ì˜¤ë¥˜ ë©”ì‹œì§€ í™•ì¸
3. **ì´ë¯¸ì§€ URL ì§ì ‘ ì ‘ê·¼**: ìƒˆ íƒ­ì—ì„œ URLì„ ì§ì ‘ ì—´ì–´ë³´ê¸°

### 4. ëŒ€ì²´ í•´ê²° ë°©ë²•

#### A. Firebase Storage ëŒ€ì‹  ë¡œì»¬ ì„œë²„ ì‚¬ìš©
```dart
// lib/services/firebase_service.dart ìˆ˜ì •
Future<String> uploadImage(...) async {
  // Firebase Storage ëŒ€ì‹  ë¡œì»¬ ì„œë²„ì— ì—…ë¡œë“œ
  final response = await http.post(
    Uri.parse('${Env.proxyBase}/upload'),
    body: bytes,
    headers: {'Content-Type': 'image/jpeg'},
  );
  return response.body; // ì„œë²„ì—ì„œ ë°˜í™˜í•œ URL
}
```

#### B. Base64 ì¸ì½”ë”© ì‚¬ìš©
```dart
// ì´ë¯¸ì§€ë¥¼ Base64ë¡œ ì¸ì½”ë”©í•˜ì—¬ Firestoreì— ì €ì¥
final base64Image = base64Encode(bytes);
await _fs.collection('photos').add({
  'imageData': base64Image,
  'contentType': 'image/jpeg',
});
```

### 5. ì„ì‹œ í•´ê²°ì±…

í˜„ì¬ ìƒí™©ì—ì„œ ì¦‰ì‹œ í•´ê²°í•˜ë ¤ë©´:

1. **ë¸Œë¼ìš°ì € ìºì‹œ ì‚­ì œ**: Ctrl+Shift+R (ê°•ì œ ìƒˆë¡œê³ ì¹¨)
2. **ë‹¤ë¥¸ ë¸Œë¼ìš°ì € ì‹œë„**: Firefox, Safari ë“±
3. **ê°œë°œì ë„êµ¬ì—ì„œ ë„¤íŠ¸ì›Œí¬ íƒ­ í™•ì¸**: ì‹¤ì œ ì˜¤ë¥˜ ë©”ì‹œì§€ í™•ì¸

## í™•ì¸ ë°©ë²•

### 1. CORS ì„¤ì • í™•ì¸
```bash
# CORS ì„¤ì •ì´ ì ìš©ë˜ì—ˆëŠ”ì§€ í™•ì¸
gsutil cors get gs://heritageservices-23a6c.appspot.com
```

### 2. ì´ë¯¸ì§€ URL í…ŒìŠ¤íŠ¸
```bash
# í„°ë¯¸ë„ì—ì„œ ì´ë¯¸ì§€ URL ì§ì ‘ í…ŒìŠ¤íŠ¸
curl -I "https://firebasestorage.googleapis.com/..."
```

### 3. Firebase Storage ì ‘ê·¼ í…ŒìŠ¤íŠ¸
```javascript
// ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ í…ŒìŠ¤íŠ¸
fetch('https://firebasestorage.googleapis.com/...')
  .then(response => console.log('Success:', response))
  .catch(error => console.log('Error:', error));
```

## ì˜ˆìƒ ê²°ê³¼

CORS ì„¤ì • ì ìš© í›„:
- âœ… ì´ë¯¸ì§€ê°€ ì •ìƒì ìœ¼ë¡œ í‘œì‹œë¨
- âœ… ë¡œë”© ì¸ë””ì¼€ì´í„°ê°€ í‘œì‹œë¨
- âœ… ì—ëŸ¬ ë°œìƒ ì‹œ ëª…í™•í•œ ë©”ì‹œì§€ í‘œì‹œ

## ì¶”ê°€ ë¬¸ì œ í•´ê²°

### Firebase Storage ê¶Œí•œ ë¬¸ì œ
```javascript
// Firebase Console â†’ Storage â†’ Rules
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /heritages/{heritageId}/{folder}/{allPaths=**} {
      allow read, write: if true;  // ê°œë°œìš© - í”„ë¡œë•ì…˜ì—ì„œëŠ” ì œí•œ í•„ìš”
    }
  }
}
```

### ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ
- ë°©í™”ë²½ ì„¤ì • í™•ì¸
- í”„ë¡ì‹œ ì„œë²„ ì‚¬ìš© ì‹œ ì„¤ì • í™•ì¸
- VPN ì‚¬ìš© ì‹œ Firebase ì ‘ê·¼ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸

## í”„ë¡œë•ì…˜ í™˜ê²½ ê³ ë ¤ì‚¬í•­

1. **ë³´ì•ˆ ê·œì¹™ ê°•í™”**: ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ì ‘ê·¼ í—ˆìš©
2. **CDN ì‚¬ìš©**: Firebase Storage + Cloud CDN ì¡°í•©
3. **ì´ë¯¸ì§€ ìµœì í™”**: WebP í¬ë§· ì‚¬ìš©, ë¦¬ì‚¬ì´ì§• ë“±
4. **ìºì‹± ì „ëµ**: ì ì ˆí•œ Cache-Control í—¤ë” ì„¤ì •
