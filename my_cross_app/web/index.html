<!DOCTYPE html>
<html>

<head>
  <!--
    If you are serving your web app in a path other than the root, change the
    href value below to reflect the base path you are serving from.

    The path provided below has to start and end with a slash "/" in order for
    it to work correctly.

    For more details:
    * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base

    This is a placeholder for base href that will be replaced by the value of
    the `--base-href` argument provided to `flutter build`.
  -->
  <base href="/">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="A new Flutter project.">

  <!-- ğŸ”¥ ìºì‹œ ì™„ì „ ë¬´íš¨í™” (ë¸Œë¼ìš°ì € ê°•ì œ ë¦¬ë¡œë“œ) -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <!-- ì›¹ì—ì„œ íŒŒì¼ ì—…ë¡œë“œë¥¼ ìœ„í•œ ì¶”ê°€ ë©”íƒ€ íƒœê·¸ -->
  <!-- âœ… ë·°í¬íŠ¸ ì„¤ì • (í™”ë©´ ë°°ìœ¨ 100% ì§€ì›) -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <meta http-equiv="Content-Security-Policy"
    content="default-src *; img-src * data: blob:; media-src * data: blob:; connect-src *; script-src * 'unsafe-inline' 'unsafe-eval'; style-src * 'unsafe-inline'; font-src * data:; script-src-elem * 'unsafe-inline' 'unsafe-eval';">

  <!-- ì‹œìŠ¤í…œ í°íŠ¸ ì‚¬ìš©ìœ¼ë¡œ í°íŠ¸ ë¡œë”© ì˜¤ë¥˜ ë°©ì§€ -->
  <style>
    /* ğŸ”¥ í™”ë©´ í¬ê¸° 100% ê°•ì œ ì ìš© - ìŠ¤í¬ë¡¤ í—ˆìš© (ìµœëŒ€í•œ ê°•ë ¥í•œ ì„¤ì •) */
    html {
      height: 100vh !important;
      width: 100vw !important;
      margin: 0 !important;
      padding: 0 !important;
      overflow: auto !important;
      position: relative !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      bottom: 0 !important;
      min-height: 100vh !important;
      min-width: 100vw !important;
      max-width: none !important;
      max-height: none !important;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
      height: 100vh !important;
      width: 100vw !important;
      margin: 0 !important;
      padding: 0 !important;
      overflow: auto !important;
      background-color: #f5f7fa !important;
      position: relative !important;
      min-height: 100vh !important;
      min-width: 100vw !important;
    }

    /* Flutter ì›¹ì—ì„œ í°íŠ¸ ë¡œë”© ì˜¤ë¥˜ ë°©ì§€ */
    * {
      font-family: inherit;
    }

    /* âœ… Flutter ë£¨íŠ¸ ìš”ì†Œë“¤ 100% í¬ê¸° ê°•ì œ (ë” ê°•ë ¥í•œ ì„¤ì •) */
    flt-glass-pane,
    flt-scene-host,
    flt-platform-view,
    flutter-view {
      width: 100vw !important;
      height: 100vh !important;
      position: absolute !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      bottom: 0 !important;
      overflow: visible !important;
      min-height: 100vh !important;
      min-width: 100vw !important;
      max-width: none !important;
      max-height: none !important;
    }

    /* Flutter ì•± ì»¨í…Œì´ë„ˆ (ìµœëŒ€í•œ ê°•ë ¥í•œ ì„¤ì •) */
    #flutter-container {
      width: 100vw !important;
      height: 100vh !important;
      min-height: 100vh !important;
      min-width: 100vw !important;
      max-width: none !important;
      max-height: none !important;
      position: absolute !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      bottom: 0 !important;
    }

    /* ğŸ”¥ ì¶”ê°€ ê°•ë ¥í•œ ë°˜ì‘í˜• ê·œì¹™ */
    html[style*="width"],
    html[style*="height"] {
      width: 100vw !important;
      height: 100vh !important;
    }

    flutter-view[style*="width"],
    flutter-view[style*="height"] {
      width: 100vw !important;
      height: 100vh !important;
    }

    /* ëª¨ë“  Flutter ê´€ë ¨ ìš”ì†Œ ê°•ì œ ë°˜ì‘í˜• */
    flt-glass-pane[style*="width"],
    flt-glass-pane[style*="height"],
    flt-scene-host[style*="width"],
    flt-scene-host[style*="height"],
    flt-platform-view[style*="width"],
    flt-platform-view[style*="height"] {
      width: 100vw !important;
      height: 100vh !important;
    }
  </style>

  <!-- iOS meta tags & icons -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="my_cross_app">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png" />

  <title>Heritage Services App</title>
  <link rel="manifest" href="manifest.json">

  <!-- Firebase SDK (Analytics ì œê±°) -->
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getFirestore, connectFirestoreEmulator } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";
    import { getStorage } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-storage.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAg4BcMA1qeRgQfV9pTxbeiwSeo4vSiP18",
      authDomain: "heritageservices-23a6c.firebaseapp.com",
      projectId: "heritageservices-23a6c",
      storageBucket: "heritageservices-23a6c.firebasestorage.app",
      messagingSenderId: "661570902154",
      appId: "1:661570902154:web:17d16562436aa476da3573"
    };

    // Initialize Firebase (Analytics ì œê±°)
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // Firebase ì—°ê²° ì„¤ì • ê°œì„ 
    console.log('ğŸ”¥ Firebase ì´ˆê¸°í™” ì™„ë£Œ');

    // ì—°ê²° ìƒíƒœ ëª¨ë‹ˆí„°ë§
    db.enableNetwork().then(() => {
      console.log('âœ… Firestore ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™œì„±í™”');
    }).catch((error) => {
      console.error('âŒ Firestore ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì‹¤íŒ¨:', error);
    });

    // ì „ì—­ ë³€ìˆ˜ë¡œ ì„¤ì • (Flutterì—ì„œ ì ‘ê·¼ ê°€ëŠ¥)
    window.firebaseApp = app;
    window.firebaseDb = db;
    window.firebaseStorage = storage;
  </script>
  <!-- âœ… Service Worker ì™„ì „ ë¹„í™œì„±í™” (HTTP í™˜ê²½ ì§€ì›) -->
  <script>
    console.log('ğŸ”¥ ìºì‹œ í´ë¦¬ì–´ ì‹œì‘...');

    // 1. ê¸°ì¡´ Service Worker ëª¨ë‘ ì œê±°
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations()
        .then((registrations) => {
          if (registrations.length > 0) {
            console.log(`ğŸ—‘ï¸ ${registrations.length}ê°œ Service Worker ì‚­ì œ ì¤‘...`);
          }
          registrations.forEach((registration) => {
            registration.unregister()
              .then(() => console.log('âœ… Service Worker ì‚­ì œë¨'))
              .catch((err) => console.warn('âš ï¸ Service worker unregister failed:', err));
          });
        })
        .catch((err) => console.warn('Service worker lookup failed:', err));
    }

    // 1-1. ëª¨ë“  ìºì‹œ ìŠ¤í† ë¦¬ì§€ ì‚­ì œ (CanvasKit wasm ìºì‹œ í¬í•¨)
    if ('caches' in window) {
      caches.keys().then(cacheNames => {
        if (cacheNames.length > 0) {
          console.log(`ğŸ—‘ï¸ ${cacheNames.length}ê°œ ìºì‹œ ì‚­ì œ ì¤‘...`);
          return Promise.all(
            cacheNames.map(cacheName => {
              console.log(`  - ì‚­ì œ: ${cacheName}`);
              return caches.delete(cacheName);
            })
          );
        }
      }).then(() => {
        console.log('âœ… ëª¨ë“  ìºì‹œ ì‚­ì œ ì™„ë£Œ');
      }).catch(err => console.warn('âš ï¸ ìºì‹œ ì‚­ì œ ì‹¤íŒ¨:', err));
    }

    // 2. Service Worker API ìì²´ë¥¼ ë¬´ë ¥í™” (ê°•ì œ ë¹„í™œì„±í™”)
    if ('serviceWorker' in navigator) {
      Object.defineProperty(navigator, 'serviceWorker', {
        get: function () {
          console.log('Service Worker API blocked for HTTP environment');
          return undefined;
        }
      });
    }

    // 3. Flutter ì„¤ì •ìœ¼ë¡œ Service Worker ë¹„í™œì„±í™” + HTML ë Œë”ëŸ¬ ê°•ì œ
    window.flutterConfiguration = {
      serviceWorkerVersion: null,
      // âœ… CanvasKit ëŒ€ì‹  HTML ë Œë”ëŸ¬ ì‚¬ìš© (HTTP í™˜ê²½ í˜¸í™˜)
      renderer: "html",
    };

    // 4. âœ… ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ê°ì§€ í›„ ê°•ì œ ì¬ë¹Œë“œ (Flutter Web viewport ë²„ê·¸ ë°©ì§€)
    window.addEventListener('resize', function () {
      // ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ ì œê±°í•˜ê³  CSS ê·œì¹™ì´ ì ìš©ë˜ë„ë¡ í•¨
      const html = document.documentElement;
      const flutterView = document.querySelector('flutter-view');

      // HTMLê³¼ Flutter ë·°ì˜ ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ ì œê±°
      html.style.removeProperty('height');
      html.style.removeProperty('width');
      if (flutterView) {
        flutterView.style.removeProperty('height');
        flutterView.style.removeProperty('width');
      }

      console.log(`ğŸ“ Window resized: ${window.innerWidth}x${window.innerHeight}`);
      window.dispatchEvent(new Event('flutter-resize'));
    });

    // ì´ˆê¸° ë¡œë“œ ì‹œì—ë„ í•œ ë²ˆ ì‹¤í–‰
    window.addEventListener('load', function () {
      // ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ ì œê±°í•˜ê³  CSS ê·œì¹™ì´ ì ìš©ë˜ë„ë¡ í•¨
      const html = document.documentElement;
      const flutterView = document.querySelector('flutter-view');

      // HTMLê³¼ Flutter ë·°ì˜ ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ ì œê±°
      html.style.removeProperty('height');
      html.style.removeProperty('width');
      if (flutterView) {
        flutterView.style.removeProperty('height');
        flutterView.style.removeProperty('width');
      }

      console.log(`ğŸ“ Initial size: ${window.innerWidth}x${window.innerHeight}`);
      window.dispatchEvent(new Event('flutter-resize'));
    });

    // 5. âœ… ì£¼ê¸°ì ìœ¼ë¡œ ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ ì œê±° (Flutterê°€ ë‹¤ì‹œ ì„¤ì •í•˜ëŠ” ê²½ìš° ëŒ€ë¹„)
    setInterval(function () {
      const html = document.documentElement;
      const flutterView = document.querySelector('flutter-view');

      if (html.style.height || html.style.width) {
        console.log('ğŸ”§ Removing HTML inline styles');
        html.style.removeProperty('height');
        html.style.removeProperty('width');
      }

      if (flutterView && (flutterView.style.height || flutterView.style.width)) {
        console.log('ğŸ”§ Removing Flutter view inline styles');
        flutterView.style.removeProperty('height');
        flutterView.style.removeProperty('width');
      }
    }, 100); // 0.1ì´ˆë§ˆë‹¤ ì²´í¬ (ë” ìì£¼)

    // 6. âœ… Flutter ë¡œë“œ ì™„ë£Œ í›„ ê°•ì œ ìŠ¤íƒ€ì¼ ì ìš©
    window.addEventListener('flutter-first-frame', function () {
      console.log('ğŸ¬ Flutter first frame loaded, applying responsive styles');
      const html = document.documentElement;
      const flutterView = document.querySelector('flutter-view');

      // ëª¨ë“  ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ ì œê±°
      html.style.removeProperty('height');
      html.style.removeProperty('width');
      if (flutterView) {
        flutterView.style.removeProperty('height');
        flutterView.style.removeProperty('width');
      }

      // CSS ê·œì¹™ ê°•ì œ ì ìš©
      html.style.setProperty('width', '100vw', 'important');
      html.style.setProperty('height', '100vh', 'important');
      if (flutterView) {
        flutterView.style.setProperty('width', '100vw', 'important');
        flutterView.style.setProperty('height', '100vh', 'important');
      }
    });
  </script>
</head>

<body>
  <!-- âœ… HTML ë Œë”ëŸ¬ ê°•ì œ ì„¤ì • (flutter_bootstrap.js ë¡œë“œ ì „ì— ì‹¤í–‰) -->
  <script>
    // ğŸ”¥ CanvasKit ì™„ì „ ì°¨ë‹¨ - HTML ë Œë”ëŸ¬ë§Œ ì‚¬ìš©
    if (!window.flutterConfiguration) {
      window.flutterConfiguration = {};
    }
    window.flutterConfiguration.renderer = "html";
    window.flutterConfiguration.canvasKitBaseUrl = null;  // CanvasKit ë¡œë“œ ì°¨ë‹¨
    console.log('ğŸ”’ Forced HTML renderer, CanvasKit blocked');
  </script>
  <!-- âœ… HTML ë Œë”ëŸ¬ ëª…ì‹œì  ì§€ì • (CanvasKit WebGL ì¶©ëŒ ë°©ì§€) -->
  <script src="flutter_bootstrap.js" data-renderer="html"></script>
</body>

</html>